# Phase 08 - Plan 01: Dark Mode System Polish & Documentation

**Phase:** 08-dark-mode-system
**Plan:** 01
**Wave:** 1
**Autonomous:** true
**Created:** 2026-01-21

---

## Objective

Adicionar smooth theme transitions usando animation tokens do Phase 7, documentar o sistema dark mode existente (que já está completo e funcional), e criar guia de best practices para dark-mode-friendly components.

**Purpose:** Dark mode JÁ está implementado (toggle, persistência, system preference, tokens CSS). Esta phase foca em polish (smooth transitions) e documentação abrangente. Transitions suaves melhoram perceived performance. Documentação clara facilita manutenção e garante novos componentes sejam dark-mode-friendly.

---

## Context

**Current State - Dark Mode JÁ COMPLETO:**
- ✅ Tokens CSS para dark mode (`.dark` com 40+ color overrides)
- ✅ Toggle de tema (Light/Dark/System) no ThemeSelector component
- ✅ Persistência via settings store (Zustand)
- ✅ Suporte a prefers-color-scheme (system mode)
- ✅ Theme application em App.tsx via useEffect
- ✅ Multiple color themes (COLOR_THEMES: default, purple, emerald, rose, amber, blue, slate, ocean)
- ❌ Smooth transitions entre temas (pode adicionar)
- ❌ Documentação abrangente (DARK_MODE.md)

**Discovery:**
```typescript
// ThemeSelector.tsx - Theme toggle JÁ existe
const handleModeChange = (mode: 'light' | 'dark' | 'system') => {
  onSettingsChange({ ...settings, theme: mode });
  updateStoreSettings({ theme: mode });
};

// globals.css - Dark mode tokens JÁ definidos
.dark {
  --background: 240 10% 3.9%;
  --foreground: 240 4.8% 95.9%;
  --primary: 228 100% 50%;
  // ... 40+ color tokens
}
```

**Scope Reality Check:**
ROADMAP original mencionava "criar tokens CSS, toggle, persistência, prefers-color-scheme, transições", mas TODOS esses features JÁ existem exceto smooth transitions.

**Decisão:** Focar em:
- Adicionar smooth color transitions usando animation tokens do Phase 7
- Documentar sistema dark mode existente completamente
- Criar guia de dark-mode-friendly component development
- Verificar que componentes modernos (Phase 02-07) são dark-mode-compatible

**Reference:**
- Animation tokens: Phase 07 (--duration-normal, --ease-out)
- Design tokens: Phase 01 (color tokens HSL)
- ThemeSelector: `apps/frontend/src/renderer/components/settings/ThemeSelector.tsx`
- ThemeSettings: `apps/frontend/src/renderer/components/settings/ThemeSettings.tsx`

**Dependencies:**
- Phase 01: Design Tokens Foundation (color tokens)
- Phase 07: Motion & Animation System (animation tokens)

---

## Tasks

### Task 1: Adicionar Smooth Theme Transitions

**Objective:** Adicionar transições suaves para mudanças de tema usando animation tokens do Phase 7.

**Files to modify:**
- `apps/frontend/src/renderer/styles/globals.css`

**Implementation:**
1. Adicionar global theme transition ao body e elementos chave:
   ```css
   body {
     background-color: hsl(var(--background));
     color: hsl(var(--foreground));
     transition:
       background-color var(--duration-normal) var(--ease-out),
       color var(--duration-normal) var(--ease-out);
   }
   ```

2. Adicionar transitions para elementos que usam color tokens:
   ```css
   * {
     transition-property: background-color, border-color, color, fill, stroke;
     transition-timing-function: var(--ease-out);
     transition-duration: var(--duration-normal);
   }

   /* Exceções: não animar transforms, opacity, etc */
   *:where([class*="animate-"]),
   *:where([class*="transition-transform"]),
   *:where([class*="transition-opacity"]) {
     transition-property: revert;
   }
   ```

3. Adicionar `@media (prefers-reduced-motion: reduce)`:
   ```css
   @media (prefers-reduced-motion: reduce) {
     *,
     ::before,
     ::after {
       transition-duration: 0.01ms !important;
       animation-duration: 0.01ms !important;
     }
   }
   ```

4. Manter performance:
   - Apenas animar color/background/border (GPU-friendly)
   - Usar will-change sparingly
   - Duração curta (200ms) para não interferir com UX

**Success criteria:**
- Build passa sem erros
- Theme changes têm smooth transition (200ms)
- Respeita prefers-reduced-motion
- Performance mantida (60fps)
- Zero breaking changes

**Commit format:** `feat(dark-mode): add smooth theme transitions with animation tokens`

---

### Task 2: Documentar Dark Mode System

**Objective:** Criar documentação abrangente do sistema dark mode existente (DARK_MODE.md).

**Files to create:**
- `.planning/phases/08-dark-mode-system/DARK_MODE.md`

**Content structure:**
1. **Overview:** Sistema dark mode completo e funcional
2. **Architecture:**
   - Token-based system (`.dark` class overrides)
   - 40+ color tokens definidos para dark mode
   - HSL color format para flexibilidade
   - Settings store (Zustand) para persistência
3. **Theme Toggle:**
   - ThemeSelector component API
   - 3 modes: Light, Dark, System
   - System preference detection (prefers-color-scheme)
   - Immediate application via store updates
4. **Color Themes:**
   - 8 color themes disponíveis (default, purple, emerald, rose, amber, blue, slate, ocean)
   - Como color themes interagem com light/dark mode
   - Customização de color themes
5. **Smooth Transitions:**
   - Como funcionam (animation tokens do Phase 7)
   - Performance considerations
   - prefers-reduced-motion support
6. **Token Reference:**
   - Tabela de todos os 40+ dark mode tokens
   - Light vs Dark comparison
   - Semantic colors (success, warning, destructive, info)
7. **Component Development:**
   - Best practices para dark-mode-friendly components
   - Usar tokens em vez de hardcoded colors
   - Testar em ambos light e dark modes
   - Evitar opacity issues (usar HSL com opacity via Tailwind)
8. **Integration:**
   - Com Phase 01 (design tokens)
   - Com Phase 07 (animation tokens para transitions)
   - Settings UI (ThemeSelector, ThemeSettings)
9. **Testing:**
   - Como testar dark mode locally
   - System preference override
   - Color contrast verification
10. **Migration Guide:**
    - Como migrar components para usar tokens
    - Common pitfalls (hardcoded colors, wrong opacity)

**Success criteria:**
- Documentação completa (~500-700 lines)
- Tabela de referência de todos os tokens
- Exemplos de código
- Best practices guide
- Testing guide

**Commit format:** `docs(dark-mode): add comprehensive dark mode system documentation`

---

### Task 3: Verificar Dark Mode Compatibility dos Componentes

**Objective:** Verificar que componentes modernizados nas Phases 02-07 são dark-mode-compatible e documentar findings.

**Files to review:**
- Todos os componentes modernizados: Text, Heading, Container, Stack, Grid
- Form components: Input, Label, Textarea, RadioGroup, FormField
- Overlay components: Dialog, Select, Popover, AlertDialog, Tooltip, DropdownMenu
- Navigation components: Tabs, Progress, Badge, Separator

**Implementation:**
1. Criar checklist de dark mode compatibility:
   - [ ] Usa color tokens (não hardcoded colors)
   - [ ] Testa bem em light e dark modes
   - [ ] Border colors corretas
   - [ ] Shadows apropriadas
   - [ ] Focus states visíveis
   - [ ] Hover states distinguíveis
   - [ ] Text contrast adequado

2. Verificar cada componente modernizado:
   - Read cada component file
   - Check que usa `var(--token)` ou classes Tailwind (que usam tokens)
   - Note qualquer hardcoded color ou issue

3. Criar relatório em DARK_MODE.md:
   - Seção "Component Compatibility"
   - Lista de componentes verificados
   - Issues encontrados (se houver)
   - Recommendations

4. Se encontrar issues, adicionar fixes:
   - Substituir hardcoded colors por tokens
   - Ajustar contrasts se necessário
   - Commit separado por componente (se needed)

**Success criteria:**
- Todos os 20+ componentes modernizados verificados
- Relatório de compatibility em DARK_MODE.md
- Issues documentados (ou zero issues encontrados)
- Fixes aplicados se necessário

**Commit format:** `refactor(dark-mode): verify and document component dark mode compatibility`

---

## Verification

After all tasks complete:

1. **Build verification:**
   ```bash
   cd apps/frontend && npm run build
   ```
   - Must build without errors
   - Transitions smooth in both light→dark and dark→light

2. **Theme transition verification:**
   - Open app in browser
   - Toggle between Light/Dark/System
   - Verify 200ms smooth transition
   - No jarring color jumps

3. **Component compatibility verification:**
   - All 20+ modernized components checked
   - No hardcoded colors found
   - All use tokens correctly

4. **Documentation verification:**
   - DARK_MODE.md existe e está completo (~500-700 lines)
   - Token reference table completa
   - Component compatibility report presente

---

## Success Criteria

- [ ] Smooth theme transitions adicionadas (200ms usando animation tokens)
- [ ] prefers-reduced-motion support implementado
- [ ] Documentação DARK_MODE.md completa (~500-700 lines)
- [ ] 20+ componentes verificados para dark mode compatibility
- [ ] Relatório de compatibility em DARK_MODE.md
- [ ] Build passa sem erros
- [ ] Zero breaking changes
- [ ] 3 commits criados (1 feat, 1 docs, 1 refactor/docs)

---

## Output

**Files Modified:**
- `apps/frontend/src/renderer/styles/globals.css` (smooth transitions)

**Files Created:**
- `.planning/phases/08-dark-mode-system/DARK_MODE.md` (documentação completa)

**Dark Mode Features (já existentes, agora documentados):**
- 8 color themes (default, purple, emerald, rose, amber, blue, slate, ocean)
- 3 appearance modes (Light, Dark, System)
- 40+ dark mode color tokens
- Theme toggle UI (ThemeSelector component)
- Settings persistence (Zustand store)
- System preference detection (prefers-color-scheme)

**New Feature Added:**
- Smooth theme transitions (200ms color transitions)
- prefers-reduced-motion support

**Components Verified:**
- 20+ modernized components (Phases 02-07)
- Dark mode compatibility report

**Commits:** 3 commits (1 feat, 1 docs, 1 refactor/docs)

**Documentation:** Comprehensive DARK_MODE.md with architecture overview, token reference, component development guide, testing guide, and compatibility report

**Next Phase:** Phase 09 (Component Migration Wave 1) - Migrar 40+ componentes existentes para usar design system modernizado

---

*Plan created: 2026-01-21*
*Estimated completion: 3 tasks, single wave execution*
